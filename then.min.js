/**
 * thenjs: v0.9.8
 * https://github.com/teambition/then.js
 */
"use strict";!function(){function a(){}function b(a){return null==a}function c(a){return"function"==typeof a}function d(a,b,c){return new Error("Argument "+a.toString()+' in "'+b+'" function is not a '+c+"!")}function e(a,e,f,g){function h(c,d,e){return k-=1,b(d)?(m[c]=e,0>=k?a(null,m):void 0):a(d)}var i,j,k,l,m=[];if(!q(e))return a(d(e,"each","array"));if(!c(f))return a(d(f,"each","function"));if(k=j=e.length,!k)return a(null,m);for(i=0;j>i;i++)l=h.bind(null,i),l.nextThenObject=o,f.call(g,l,e[i],i,e)}function f(a,e,f,g){function h(c,d){return j+=1,b(c)?(k[j-1]=d,i>j?f.call(g,h,e[j],j,e):(delete k[-1],a(null,k))):a(c)}var i,j=-1,k=[];return h.nextThenObject=o,q(e)?c(f)?(i=e.length,i?h():a(null,k)):a(d(f,"eachSeries","function")):a(d(e,"eachSeries","array"))}function g(a,e,f){function g(c,d,e){return j-=1,b(d)?(l[c]=e,0>=j?a(null,l):void 0):a(d)}var h,i,j,k,l=[];if(!q(e))return a(d(e,"parallel","array"));if(j=i=e.length,!j)return a(null,l);for(h=0;i>h;h++){if(!c(e[h]))return a(d(e[h],"parallel","function"));k=g.bind(null,h),k.nextThenObject=o,e[h].call(f,k,h)}}function h(a,e,f){function g(k,l){return i+=1,b(k)?(j[i-1]=l,h>i?c(e[i])?e[i].call(f,g,i):a(d(e[i],"series","function")):(delete j[-1],a(null,j))):a(k)}var h,i=-1,j=[];return g.nextThenObject=o,q(e)?(h=e.length,h?g():a(null,j)):a(d(e,"series","array"))}function i(a,b){r(function(){try{b()}catch(c){a(c)}})}function j(a,b){return c(b)?b.nextThenObject?b:b.bind(null,a):null}function k(d){function i(a,b){var c=new m,d=c.defer.bind(c);return d.nextThenObject=c,a(d,b),c}var k=[],l=0,m=function(){},n=m.prototype;return n.debug=!d||c(d)?d:"object"==typeof console&&console.log&&function(){console.log.apply(console,arguments)},n.all=function(a){return i(function(b,c){c._all=j(b,a)},this)},n.then=function(a,b){return i(function(c,d){d._success=j(c,a),d._error=j(c,b)},this)},n.fail=function(a){return i(function(b,c){c._fail=j(b,a),c._success=b.bind(b,null),c._fail&&k.push(c._fail)},this)},n.each=function(a,b,c){return i(function(d,f){f._each=function(f,g,h){e(d,a||f,b||g,c||h)}},this)},n.eachSeries=function(a,b,c){return i(function(d,e){e._eachSeries=function(e,g,h){f(d,a||e,b||g,c||h)}},this)},n.parallel=function(a,b){return i(function(c,d){d._parallel=function(d,e){g(c,a||d,b||e)}},this)},n.series=function(a,b){return i(function(c,d){d._series=function(d,e){h(c,a||d,b||e)}},this)},n.defer=function(c){function d(){if(f.debug){var a=p.call(g);a.unshift("\nResult of chain "+l+":"),f.debug.apply(f.debug,a)}if(f._all)f._all.apply(f._all.nextThenObject,p.call(g));else{if(!b(c))throw c;f._success.apply(f._success.nextThenObject,p.call(g,1))}}function e(a){if(!f._error&&!k.length)throw a;f._error=f._error||k.shift(),f._error.call(f._error.nextThenObject,a)}var f=this,g=arguments;l+=1,f._error=f._fail?k.shift():f._error,f._success=f._success||f._each||f._eachSeries||f._parallel||f._series||a;try{d()}catch(h){e(h)}finally{f._all=a}},i}function l(a){return function(b,c,d,e){return k(e)(function(e){i(e,a.bind(null,e,b,c,d))})}}function m(a){return function(b,c,d){return k(d)(function(d){i(d,a.bind(null,d,b,c))})}}function n(a,b,d){return k(d)(function(d){i(d,c(a)?a.bind(b,d):d)})}var o={},p=[].slice,q=Array.isArray,r="object"==typeof process&&process.nextTick?process.nextTick:setTimeout;return n.each=l(e),n.eachSeries=l(f),n.parallel=m(g),n.series=m(h),"undefined"!=typeof module&&module.exports?module.exports=n:"function"==typeof define&&define(function(){return n}),"object"==typeof window&&(window.then=n),n}();