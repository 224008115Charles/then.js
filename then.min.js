/**
 * thenjs: v1.1.1
 * https://github.com/teambition/then.js
 */
!function(a,b){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=b():"function"==typeof define&&define.amd?define([],b):a.thenjs=b()}(this,function(){"use strict";function a(){}function b(a,b,c){return new Error("Argument "+(a&&a.toString())+' in "'+b+'" is not a '+(c||"array")+"!")}function c(a,b){try{b.apply(null,q.call(arguments,2))}catch(c){a(c)}}function d(a,b){var c=q.call(arguments,2);s(function(){try{b.apply(null,c)}catch(d){a(d)}})}function e(a){u.debug="function"==typeof a?a:function(){console.log.apply(console,arguments)}}function f(a){var b=this;if(b._result!==!1){b._result?b._result=!1:b._chain&&b.debug.apply(b,["\nChain "+b._chain+": "].concat(q.call(arguments)));try{g(b,arguments,a)}catch(c){h(b,c,a)}}}function g(a,b,c){if(a._all)return a._all.apply(null,b);if(null!=c)throw c;var d=a._success||a._each||a._eachSeries||a._parallel||a._series;return d?d.apply(null,q.call(b,1)):void(a._result=b)}function h(a,b,c){var d=a._nextThen,e=a._error||a._fail;if(b.stack&&(b.stack=b.stack),a._nextThen&&null==c)return f.call(a._nextThen,b);for(;!e&&d;)e=d._fail,d=d._nextThen;return e?e.call(null,b):p.onerror?p.onerror(b):void(a._result=[b])}function i(b,c,d){function g(){return f.apply(h,arguments)}var h=new a;return g._isCont=!0,d&&(h._chain=(e(d),1)),b(g,c),c?(c._nextThen=h,c._chain&&(h._chain=c._chain+1),c._result&&s(function(){f.apply(c,c._result)}),h):h}function j(a,b){return b._isCont?b:function(){b.apply(null,[a].concat(q.call(arguments)))}}function k(a,b,c,d){function e(e,f){return null!=e?a(e):(b[d]=f,--c.i<0&&a(null,b))}return e._isCont=!0,e}function l(a,c,d){var e,f=[],g={};if(!t(c))return a(b(c,"each"));if(g.i=e=c.length-1,0>e)return a(null,f);for(var h=0;e>=h;h++)d(k(a,f,g,h),c[h],h,c)}function m(a,c){var d,e=[],f={};if(!t(c))return a(b(c,"parallel"));if(f.i=d=c.length-1,0>d)return a(null,e);for(var g=0;d>=g;g++)c[g](k(a,e,f,g),g,c)}function n(a,e,f){function g(b,n){return null!=b?a(b):(l[k]=n,++k>h?a(null,l):(i=--j?c:(j=m,d),void i(a,f,g,e[k],k,e)))}var h,i,j,k=0,l=[],m=+p.maxTickDepth;return g._isCont=!0,j=m=m>=1?m:100,t(e)?(h=e.length-1,0>h?a(null,l):void f(g,e[k],k,e)):a(b(e,"eachSeries"))}function o(a,e){function f(b,m){return null!=b?a(b):(k[j]=m,++j>g?a(null,k):(h=--i?c:(i=l,d),void h(a,e[j],f,j,e)))}var g,h,i,j=0,k=[],l=+p.maxTickDepth;return f._isCont=!0,i=l=l>=1?l:100,t(e)?(g=e.length-1,0>g?a(null,k):void e[j](f,j,e)):a(b(e,"series"))}function p(a,b){var e=this instanceof p?c:d;return i(function(b){return a?void e(b,a,b):b()},null,b)}var q=Array.prototype.slice,r=Object.prototype.toString,s="function"==typeof setImmediate?setImmediate:function(a){setTimeout(a,0)},t=Array.isArray||function(a){return"[object Array]"===r.call(a)},u=a.prototype;return u.all=function(a){return i(function(b,c){c._all=j(b,a)},this)},u.then=function(a,b){return i(function(c,d){d._success=j(c,a),d._error=b&&j(c,b)},this)},u.fail=function(a){return i(function(b,c){c._fail=j(b,a),c._success=function(){b.apply(null,[null].concat(q.call(arguments)))}},this)},u.each=function(a,b){return i(function(c,d){d._each=function(d,e){l(c,a||d,b||e)}},this)},u.eachSeries=function(a,b){return i(function(c,d){d._eachSeries=function(d,e){n(c,a||d,b||e)}},this)},u.parallel=function(a){return i(function(b,c){c._parallel=function(c){m(b,a||c)}},this)},u.series=function(a){return i(function(b,c){c._series=function(c){o(b,a||c)}},this)},p.each=function(a,b,c){return i(function(c){d(c,l,c,a,b)},null,c)},p.eachSeries=function(a,b,c){return i(function(c){d(c,n,c,a,b)},null,c)},p.parallel=function(a,b){return i(function(b){d(b,m,b,a)},null,b)},p.series=function(a,b){return i(function(b){d(b,o,b,a)},null,b)},p.nextTick=function(a){var b=q.call(arguments,1);s(function(){a.apply(null,b)})},p.defer=d,p.maxTickDepth=100,p.onerror=function(a){console.error("thenjs caught error: ",a)},p});