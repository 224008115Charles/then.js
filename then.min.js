/**
 * thenjs: v1.3.1
 * https://github.com/teambition/then.js
 */
!function(a,b){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=b():"function"==typeof define&&define.amd?define([],b):a.Thenjs=b()}(this,function(){"use strict";function a(a,b){var c=[],d=a.length;for(b=b||0;d-->b;)c[d-b]=a[d];return c}function b(b,c){try{c.apply(null,a(arguments,2))}catch(d){b(d)}}function c(b,c){var d=a(arguments,2);t(function(){try{c.apply(null,d)}catch(a){b(a)}})}function d(a,b){var c,e=this;if(a instanceof d)return a;if(!(e instanceof d))return new d(a,b);if(e._success=e._each=e._eachSeries=e._parallel=e._series=null,e._finally=e._error=e._fail=e._result=e._nextThen=e._chain=null,!arguments.length)return e;c=h(e,b);try{"function"==typeof a?a(c):null==a?c():"function"==typeof a.toThunk?a.toThunk()(c):a.constructor&&"Promise"===a.constructor.name?a.then(function(a){c(null,a)},c):c(null,a)}catch(f){c(f)}}function e(b){function c(){try{f(e,h,b)}catch(a){t(function(){g(e,a,b)})}}var e=this,h=arguments;if(e._result!==!1){if(!e._result&&e._chain&&e.debug.apply(e,["\nChain "+e._chain+": "].concat(a(h))),e._result=!1,--r>0)return c();r=+d.maxTickDepth,t(c)}}function f(b,c,d){if(b._finally)return b._finally.apply(null,c);if(null!=d)throw d;var e=b._success||b._each||b._eachSeries||b._parallel||b._series;return e?e.apply(null,a(c,1)):void(b._result=c)}function g(a,b,c){var e=a,f=a._error||a._fail;for(a._nextThen&&null==c&&(f=null,e=a._nextThen);!f&&e;)f=e._fail,e=e._nextThen;return f?f(b):d.onerror?d.onerror(b):void(e._result=[b])}function h(a,b){function c(){return e.apply(a,arguments)}return c._isCont=!0,b&&(v.debug="function"==typeof b?b:p,a._chain=1),c}function i(a,b,c){var f=new d,g=h(f,c);return a(g,b),b?(b._nextThen=f,b._chain&&(f._chain=b._chain+1),b._result&&t(function(){e.apply(b,b._result)}),f):f}function j(b,c){return c._isCont?c:function(){c.apply(null,[b].concat(a(arguments)))}}function k(a,b,c,d){function e(e,f){return c.finished?void 0:null!=e?(c.finished=!0,a(e)):(b[d]=f,--c.i<0&&a(null,b))}return e._isCont=!0,e}function l(a,b,c){var d,e=[],f={};if(!u(b))return a(q(b,"each"));if(f.i=d=b.length-1,0>d)return a(null,e);for(var g=0;d>=g;g++)c(k(a,e,f,g),b[g],g,b)}function m(a,b){var c,d=[],e={};if(!u(b))return a(q(b,"parallel"));if(e.i=c=b.length-1,0>c)return a(null,d);for(var f=0;c>=f;f++)b[f](k(a,d,e,f),f,b)}function n(a,e,f){function g(m,n){return null!=m?a(m):(k[j]=n,++j>h?a(null,k):(i=--l>0?b:(l=+d.maxTickDepth,c),void i(a,f,g,e[j],j,e)))}var h,i,j=0,k=[],l=+d.maxTickDepth;return g._isCont=!0,u(e)?(h=e.length-1,0>h?a(null,k):void f(g,e[0],0,e)):a(q(e,"eachSeries"))}function o(a,e){function f(l,m){return null!=l?a(l):(j[i]=m,++i>g?a(null,j):(h=--k>0?b:(k=+d.maxTickDepth,c),void h(a,e[i],f,i,e)))}var g,h,i=0,j=[],k=+d.maxTickDepth;return f._isCont=!0,u(e)?(g=e.length-1,0>g?a(null,j):void e[0](f,0,e)):a(q(e,"series"))}function p(){console.log.apply(console,arguments)}function q(a,b){return new Error("The argument "+(a&&a.toString())+' in "'+b+'" is not Array!')}var r=100,s=Object.prototype.toString,t="function"==typeof setImmediate?setImmediate:function(a){setTimeout(a,0)},u=Array.isArray||function(a){return"[object Array]"===s.call(a)};d.NAME="Thenjs",d.VERSION="1.3.1",d.maxTickDepth=r,d.defer=c,d.each=function(a,b,d){return i(function(d){c(d,l,d,a,b)},null,d)},d.eachSeries=function(a,b,d){return i(function(d){c(d,n,d,a,b)},null,d)},d.parallel=function(a,b){return i(function(b){c(b,m,b,a)},null,b)},d.series=function(a,b){return i(function(b){c(b,o,b,a)},null,b)},d.nextTick=function(b){var c=a(arguments,1);t(function(){b.apply(null,c)})},d.onerror=function(a){throw console.error("Thenjs caught error: ",a),a};var v=d.prototype;return v.fin=v.all=v.finally=function(a){return i(function(b,c){c._finally=j(b,a)},this)},v.then=function(a,b){return i(function(c,d){d._success=j(c,a),d._error=b&&j(c,b)},this)},v.fail=v.catch=function(b){return i(function(c,d){d._fail=j(c,b),d._success=function(){c.apply(null,[null].concat(a(arguments)))}},this)},v.each=function(a,b){return i(function(c,d){d._each=function(d,e){l(c,a||d,b||e)}},this)},v.eachSeries=function(a,b){return i(function(c,d){d._eachSeries=function(d,e){n(c,a||d,b||e)}},this)},v.parallel=function(a){return i(function(b,c){c._parallel=function(c){m(b,a||c)}},this)},v.series=function(a){return i(function(b,c){c._series=function(c){o(b,a||c)}},this)},v.toThunk=function(){var a=this;return function(b){a._result?(b.apply(null,a._result),a._result=!1):a._result!==!1&&(a._finally=b)}},d});