/**
 * thenjs: v1.1.5
 * https://github.com/teambition/then.js
 */
!function(a,b){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=b():"function"==typeof define&&define.amd?define([],b):a.thenjs=b()}(this,function(){"use strict";function a(a,b){var c=[],d=a.length;for(b=b||0;d-->b;)c[d-b]=a[d];return c}function b(){this._success=this._each=this._eachSeries=this._parallel=this._series=null,this._finally=this._error=this._fail=this._result=this._chain=this._nextThen=null}function c(a,b,c){return new Error("Argument "+(a&&a.toString())+' in "'+b+'" is not a '+(c||"array")+"!")}function d(b,c){try{c.apply(null,a(arguments,2))}catch(d){b(d)}}function e(b,c){var d=a(arguments,2);t(function(){try{c.apply(null,d)}catch(a){b(a)}})}function f(){console.log.apply(console,arguments)}function g(b){function c(){try{h(d,e,b)}catch(a){t(function(){i(d,a,b)})}}var d=this,e=arguments;if(d._result!==!1){if(!d._result&&d._chain&&d.debug.apply(d,["\nChain "+d._chain+": "].concat(a(e))),d._result=!1,--r>0)return c();r=+q.maxTickDepth,t(c)}}function h(b,c,d){if(b._finally)return b._finally.apply(null,c);if(null!=d)throw d;var e=b._success||b._each||b._eachSeries||b._parallel||b._series;return e?e.apply(null,a(c,1)):void(b._result=c)}function i(a,b,c){var d=a._nextThen,e=a._error||a._fail;for(d&&null==c&&(e=null);!e&&d;)e=d._fail,d=d._nextThen;return e?e(b):q.onerror?q.onerror(b):void(d._result=[b])}function j(a,c,d){function e(){return g.apply(h,arguments)}var h=new b;return e._isCont=!0,d&&(v.debug="function"==typeof d?d:f,h._chain=1),a(e,c),c?(c._nextThen=h,c._chain&&(h._chain=c._chain+1),c._result&&t(function(){g.apply(c,c._result)}),h):h}function k(b,c){return c._isCont?c:function(){c.apply(null,[b].concat(a(arguments)))}}function l(a,b,c,d){function e(e,f){return c.finished?void 0:null!=e?(c.finished=!0,a(e)):(b[d]=f,--c.i<0&&a(null,b))}return e._isCont=!0,e}function m(a,b,d){var e,f=[],g={};if(!u(b))return a(c(b,"each"));if(g.i=e=b.length-1,0>e)return a(null,f);for(var h=0;e>=h;h++)d(l(a,f,g,h),b[h],h,b)}function n(a,b){var d,e=[],f={};if(!u(b))return a(c(b,"parallel"));if(f.i=d=b.length-1,0>d)return a(null,e);for(var g=0;d>=g;g++)b[g](l(a,e,f,g),g,b)}function o(a,b,f){function g(c,m){return null!=c?a(c):(k[j]=m,++j>h?a(null,k):(i=--l>0?d:(l=+q.maxTickDepth,e),void i(a,f,g,b[j],j,b)))}var h,i,j=0,k=[],l=+q.maxTickDepth;return g._isCont=!0,u(b)?(h=b.length-1,0>h?a(null,k):void f(g,b[0],0,b)):a(c(b,"eachSeries"))}function p(a,b){function f(c,l){return null!=c?a(c):(j[i]=l,++i>g?a(null,j):(h=--k>0?d:(k=+q.maxTickDepth,e),void h(a,b[i],f,i,b)))}var g,h,i=0,j=[],k=+q.maxTickDepth;return f._isCont=!0,u(b)?(g=b.length-1,0>g?a(null,j):void b[0](f,0,b)):a(c(b,"series"))}function q(a,b){var c=this instanceof q?d:e;return j(function(b){return a?void c(b,a,b):b()},null,b)}var r,s=Object.prototype.toString,t="function"==typeof setImmediate?setImmediate:function(a){setTimeout(a,0)},u=Array.isArray||function(a){return"[object Array]"===s.call(a)},v=b.prototype;return v.fin=v.all=v.finally=function(a){return j(function(b,c){c._finally=k(b,a)},this)},v.then=function(a,b){return j(function(c,d){d._success=k(c,a),d._error=b&&k(c,b)},this)},v.fail=v.catch=function(b){return j(function(c,d){d._fail=k(c,b),d._success=function(){c.apply(null,[null].concat(a(arguments)))}},this)},v.each=function(a,b){return j(function(c,d){d._each=function(d,e){m(c,a||d,b||e)}},this)},v.eachSeries=function(a,b){return j(function(c,d){d._eachSeries=function(d,e){o(c,a||d,b||e)}},this)},v.parallel=function(a){return j(function(b,c){c._parallel=function(c){n(b,a||c)}},this)},v.series=function(a){return j(function(b,c){c._series=function(c){p(b,a||c)}},this)},q.each=function(a,b,c){return j(function(c){e(c,m,c,a,b)},null,c)},q.eachSeries=function(a,b,c){return j(function(c){e(c,o,c,a,b)},null,c)},q.parallel=function(a,b){return j(function(b){e(b,n,b,a)},null,b)},q.series=function(a,b){return j(function(b){e(b,p,b,a)},null,b)},q.nextTick=function(b){var c=a(arguments,1);t(function(){b.apply(null,c)})},q.defer=e,r=q.maxTickDepth=100,q.onerror=function(a){throw console.error("thenjs caught error: ",a),a},q});